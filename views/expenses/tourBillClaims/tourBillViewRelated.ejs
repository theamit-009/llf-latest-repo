<% include ../../partials/navbar %>
<% include ../../partials/messages %>
<% include ../../partials/footer %>
<p id="tourbillId"><%= tourbillId %></p>
  <!-- Tour Bill Detail and Related Modal  Start -->

  <div class="modal fade" id="popupTourBillModal">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">

            <!-- Modal Header -->
            <div class="modal-header">
                <h4 class="modal-title">Tour Bill  Claim Name </h4>
                <!-- <button type="button" class="close" data-dismiss="modal">&times;</button> -->
            </div>

            <!-- Modal body -->
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-12">
                        <nav>
                            <div class="nav nav-tabs nav-fill" id="nav-tab" role="tablist">
                                <a class="nav-item nav-link active" id="nav-home-tab" data-toggle="tab" href="#nav-home" role="tab" aria-controls="nav-home" aria-selected="true">Details</a>
                                <a class="nav-item nav-link" id="nav-profile-tab" data-toggle="tab" href="#nav-profile" role="tab" aria-controls="nav-profile" aria-selected="false">Related</a>
                            </div>
                        </nav>
                        <div class="tab-content" id="nav-tabContent">
                            <div class="tab-pane fade show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab">
                                <!-- Particular Expense Details -->
                                <table id="tourBillClaimTable" class="table table-hover striped">
                                    <!-- Inside code is handled by Jquery to add dyanamic Content -->
                                    <div id="tourBillClaimTableSpinner">
                                            <center> <img src="/spinner-gif-transparent-background-14.gif" />  </center>
                                    </div>
                                </table>
                                <!-- Particular Expense Details-->
                            </div>
                            <div class="tab-pane fade" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab">
                                <div class="accordion" id="accordionExample">

                                    <div class="card">
                                        <div class="card-header" id="headingOne">
                                            <h5 class="mb-0">
                                            <button class="btn btn-link text-left collapsed" type="pettyCashButton"
                                                data-toggle="collapse" data-target="#collapseOne"
                                                aria-expanded="true" aria-controls="collapseOne">
                                                <i class="fa fa-angle-double-right mr-3"></i>Air/Rail/Bus  Fare
                                            </button>
                                            <a href="#" class="btn btn-primary float-right airRailBusCharges" id="airRailBusCharges" style="color:white;" >New</a>
                                        </h5>
                                        </div>

                                        <div id="collapseOne" class="collapse  fade" aria-labelledby="headingOne" data-parent="#accordionExample">
                                            <div class="card-body">
                                                <!-- Need to show Table -->
                                                <table id="airRailBusTable" class="table table-striped">

                                                </table>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="card">
                                        <div class="card-header" id="headingTwo">
                                            <h5 class="mb-0">
                                            <button class="btn btn-link text-left collapsed" type="pettyCashButton"
                                                data-toggle="collapse" data-target="#collapseTwo"
                                                aria-expanded="true" aria-controls="collapseTwo">
                                                <i class="fa fa-angle-double-right mr-3"></i>Conveyance Charges
                                            </button>
                                            <a href="#" class="btn btn-primary float-right conveyanceCharges" id="pettyCashButton" style="color:white;" >New</a>
                                        </h5>
                                        </div>

                                        <div id="collapseTwo" class="collapse fade" aria-labelledby="headingTwo" data-parent="#accordionExample">
                                            <div class="card-body">
                                                <!-- Need to show Table -->
                                                <table id="conveyanceChargesTable" class="table table-striped">

                                                </table>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="card">
                                        <div class="card-header" id="headingThree">
                                            <h5 class="mb-0">
                                            <button class="btn btn-link text-left collapsed" type="pettyCashButton"
                                                data-toggle="collapse" data-target="#collapseThree"
                                                aria-expanded="true" aria-controls="collapseThree">
                                                <i class="fa fa-angle-double-right mr-3"></i>Boarding & Lodging Charges
                                            </button>
                                             <!-- <button class="btn btn-primary float-right" id="pettyCashButton" >New</button> -->
                                            <a href="#" class="btn btn-primary float-right boardingLodgingCharges" id="boardingLodgingCharges" style="color:white;" >New</a>
                                        </h5>
                                        </div>

                                        <div id="collapseThree" class="collapse  fade" aria-labelledby="headingThree" data-parent="#accordionExample">
                                            <div class="card-body">
                                                <!-- Need to show Table -->
                                                <table id="boardingLodgingChargesTable" class="table table-striped">

                                                </table>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="card">
                                        <div class="card-header" id="headingFour">
                                            <h5 class="mb-0">
                                            <button class="btn btn-link collapsed text-left" type="button"
                                                data-toggle="collapse" data-target="#collapseFour"
                                                aria-expanded="false" aria-controls="collapseFour">
                                                <i class="fa fa-angle-double-right mr-3"></i>Telephone & Food Charges
                                            </button>
                                            <!-- <button class="btn btn-primary float-right">New</button> -->
                                            <a href="#" class="btn btn-primary float-right telephoneFood" style="color:white;">New</a>
                                        </h5>
                                        </div>
                                        <div id="collapseFour" class="collapse fade" aria-labelledby="headingFour" data-parent="#accordionExample">
                                            <div class="card-body">
                                                <!-- Need to create table here -->
                                                <table id="telephoneFoodChargesTable" class="table table-striped">

                                                </table>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="card">
                                        <div class="card-header" id="headingFive">
                                            <h5 class="mb-0">
                                            <button class="btn btn-link collapsed text-left" type="button"
                                                data-toggle="collapse" data-target="#collapseFive"
                                                aria-expanded="false" aria-controls="collapseFive">
                                                <i class="fa fa-angle-double-right mr-3"></i>Miscellaneous Charges
                                            </button>
                                            <!-- <button class="btn btn-primary float-right">New</button> -->
                                            <a href="#" class="btn btn-primary float-right miscellaneousCharges" style="color:white;"  id="tourBillClaim">New</a>
                                        </h5>
                                        </div>
                                        <div id="collapseFive" class="collapse fade" aria-labelledby="headingFive" data-parent="#accordionExample">
                                            <div class="card-body">
                                                <!-- Need to create table here -->
                                                <table id="miscellaneousChargesTable" class="table table-striped">

                                                </table>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Modal footer -->
            <div class="modal-footer">
               <!--  <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button> -->
            </div>

        </div>
    </div>
</div>

<script>
    $(document).ready(function(){
       $('#tourbillId').hide();
        let tourBillClaimId = document.getElementById('tourbillId').innerHTML;
        alert('tourBillClaimId  : '+tourBillClaimId);
     //   $('#hiddenExpenseId').val(expenseId); // setting toubill ceate Hide Id
        $("#popupTourBillModal").modal("show"); 
        $.ajax({
                  type: 'get',
                  url : '/expense/tourBillClaim/getRelatedTourBillClaimDetails/'+tourBillClaimId,
                  dataType : 'json',
                  beforeSend : function(){
                      $('#tourBillClaimTableSpinner').show();
                  }
                
              })
              .done((responseData) => {
                  $('#tourBillClaimTableSpinner').hide(); 
                  console.log('response getRelatedTourBillClaimDetails data '+JSON.stringify(responseData));
                  let tourBillClaim = responseData.tourBillClaim;
                  console.log('tourBillClaim  '+JSON.stringify(tourBillClaim));
                  let tourBillClaimTableHtml = '';
                  tourBillClaimTableHtml += '<tr>';
                  tourBillClaimTableHtml += '<td>Name</td>';
                  tourBillClaimTableHtml += '<td>'+tourBillClaim.name+'</td>';
                  tourBillClaimTableHtml += '<td>Expense </td>';
                  tourBillClaimTableHtml += '<td>'+tourBillClaim.expname+'</td>';
                  tourBillClaimTableHtml += '</tr>'; 
                  tourBillClaimTableHtml += '<tr>'; 
                  tourBillClaimTableHtml += '<td>Grand Total</td>';
                  tourBillClaimTableHtml += '<td>'+tourBillClaim.grand__c+'</td>';
                  tourBillClaimTableHtml += '<td></td>';
                  tourBillClaimTableHtml += '<td></td>';
                  tourBillClaimTableHtml += '</tr>';

                  
                  $('#tourBillClaimTable').html(tourBillClaimTableHtml);
    
    
                  let airBusRailFare = responseData.airBusRailFare;
                  console.log('airBusRailFare  '+JSON.stringify(airBusRailFare));
                  let airBusRailFareHtml = '';
                  if(airBusRailFare.length > 0)
                  {
                    airBusRailFareHtml = '<thead>';
                    airBusRailFareHtml += '<th>Air Rail Bus Fares</th>';
                    airBusRailFareHtml += '<th>Arrival Date</th>';
                    airBusRailFareHtml += '<th>Departure Date</th>';
                    airBusRailFareHtml += '<th>Amount</th>';
                    airBusRailFareHtml += '</thead>';
                    airBusRailFareHtml += '<tbody>';
    
                    airBusRailFare.forEach((eachAirRailBus) => {
                      let strArrivalDate = eachAirRailBus.arrival_date__c.toString().split('T')[0];
                      let strDepartureDate = eachAirRailBus.departure_date__c.toString().split('T')[0];
                      airBusRailFareHtml += '<tr>';
                      airBusRailFareHtml += '<td>'+eachAirRailBus.name+'</td>';
                      airBusRailFareHtml += '<td>'+strArrivalDate+'</td>';
                      airBusRailFareHtml += '<td>'+strDepartureDate+'</td>';
                      airBusRailFareHtml += '<td>'+eachAirRailBus.amount__c+'</td>';
                      airBusRailFareHtml += '</tr>';
                    });
                    airBusRailFareHtml += '<tr ><td colspan="4"><center><a target="_blank" href="/expense/tourBillClaim/getAirBusListView?tourBillClaimId='+tourBillClaimId+'" >View All</a></center></td></tr>';
                    airBusRailFareHtml += '</tbody>';
                    
                    $('#airRailBusTable').html(airBusRailFareHtml);
                  }
    
    
                  let conveyanceCharges = responseData.conveyanceCharges;
                  console.log('conveyanceCharges  '+JSON.stringify(conveyanceCharges));
                  if(conveyanceCharges.length > 0)
                  {
                    let conveyanceChargesHtml = '<thead>';
                    conveyanceChargesHtml += '<th>ConveyanceCharges</th>';
                    conveyanceChargesHtml += '<th>Amount</th>';
                    conveyanceChargesHtml += '<th>Date</th>';
                    conveyanceChargesHtml += '</thead><tbody>';
                    conveyanceCharges.forEach((eachConveyanceCharge) => {
                      let strDate = eachConveyanceCharge.date__c.toString().split('T')[0]; 
                      conveyanceChargesHtml += '<tr>';
                      conveyanceChargesHtml += '<td>'+eachConveyanceCharge.name+'</td>';
                      conveyanceChargesHtml += '<td>'+strDate+'</td>';
                      conveyanceChargesHtml += '<td>'+eachConveyanceCharge.amount__c+'</td>';  
                      conveyanceChargesHtml += '</tr>';
                    });
                    conveyanceChargesHtml += '<tr ><td colspan="4"><center><a target="_blank" href="/expense/tourBillClaim/conveyanceChargesListView?tourBillClaimId='+tourBillClaimId+'" >View All</a></center></td></tr>';
                    conveyanceChargesHtml += '</tbody>';
                    
                    $('#conveyanceChargesTable').html(conveyanceChargesHtml);
                  }
    
                  let boardingLodgingCharges = responseData.boardingLodgingCharges;
                  console.log('boardingLodgingCharges  '+JSON.stringify(boardingLodgingCharges));
                  if(boardingLodgingCharges.length > 0)
                  {
                    let boardingLodgingChargesHtml = '<thead>';
                        boardingLodgingChargesHtml += '<th>Boarding Lodging  Number</th>';
                        boardingLodgingChargesHtml += '<th>Amount for Boarding & Lodging</th>';
                        boardingLodgingChargesHtml += '<th>Place Journey</th>';
                        boardingLodgingChargesHtml += '</thead><tbody>';
                      boardingLodgingCharges.forEach((eachBoardingLodging) => {
                        boardingLodgingChargesHtml += '<tr>';
                        boardingLodgingChargesHtml += '<td>'+eachBoardingLodging.name+'</td>';
                        boardingLodgingChargesHtml += '<td>'+eachBoardingLodging.total_amount__c+'</td>';
                        boardingLodgingChargesHtml += '<td>'+eachBoardingLodging.place_journey__c+'</td>';  
                        boardingLodgingChargesHtml += '</tr>';
                    });
                    boardingLodgingChargesHtml+='<tr ><td colspan="4"><center><a target="_blank" href="/expense/tourBillClaim/boardingLodgingListView?tourBillClaimId='+tourBillClaimId+'" >View All</a></center></td></tr>';
                    boardingLodgingChargesHtml += '</tbody>'

                    $('#boardingLodgingChargesTable').html(boardingLodgingChargesHtml);
                  }
    
                  let telephoneFoodCharges = responseData.telephoneFoodCharges;
                  console.log('telephoneFoodCharges  '+JSON.stringify(telephoneFoodCharges));
                  if(telephoneFoodCharges.length > 0)
                  {
                      let telephoneFoodChargesHtml = '<thead>';
                          telephoneFoodChargesHtml += '<th>Telephone Food & Laundry Expense Number</th>';
                          telephoneFoodChargesHtml += '<th>Fooding Expense</th>';
                          telephoneFoodChargesHtml += '<th>Laundry Expense</th>';
                          telephoneFoodChargesHtml += '<th>Reamrks</th>';
                          telephoneFoodChargesHtml += '</thead><tbody>';
                    telephoneFoodCharges.forEach((eachTelephoneFoodCharge) => {
                          telephoneFoodChargesHtml += '<tr>';
                          telephoneFoodChargesHtml += '<td>'+eachTelephoneFoodCharge.name+'</td>';
                          telephoneFoodChargesHtml += '<td>'+eachTelephoneFoodCharge.laundry_expense__c+'</td>';
                          telephoneFoodChargesHtml += '<td>'+eachTelephoneFoodCharge.fooding_expense__c+'</td>';  
                          telephoneFoodChargesHtml += '<td>'+eachTelephoneFoodCharge.remarks__c+'</td>';  
                          telephoneFoodChargesHtml += '</tr>';
                    });
                    telephoneFoodChargesHtml+='<tr ><td colspan="4"><center><a target="_blank" href="/expense/tourBillClaim/telephoneFoodCharge?tourBillClaimId='+tourBillClaimId+'" >View All</a></center></td></tr>';
                    telephoneFoodChargesHtml += '</tbody>'

                    $('#telephoneFoodChargesTable').html(telephoneFoodChargesHtml);
                  }
    
                  let miscellenousCharges = responseData.miscellenousCharges;
                  console.log('miscellenousCharges   '+JSON.stringify(miscellenousCharges));
                  if(miscellenousCharges.length > 0)
                  {
                    let miscellenousChargesHtml = '<thead>';
                        miscellenousChargesHtml += '<th>Miscellaneous Name</th>';
                        miscellenousChargesHtml += '<th>Date</th>';
                        miscellenousChargesHtml += '<th>Amount</th>';
                        miscellenousChargesHtml += '<th>Remarks</th>';
                        miscellenousChargesHtml += '</thead><tbody>';
                    miscellenousCharges.forEach((eachMiscellenousCharge) => {
                        let strDate = eachMiscellenousCharge.date__c.toString().split('T')[0];
                        miscellenousChargesHtml += '<tr>';
                        miscellenousChargesHtml += '<td>'+eachMiscellenousCharge.name+'</td>';
                        miscellenousChargesHtml += '<td>'+strDate+'</td>';
                        miscellenousChargesHtml += '<td>'+eachMiscellenousCharge.amount__c+'</td>';  
                        miscellenousChargesHtml += '<td>'+eachMiscellenousCharge.remarks__c+'</td>';  
                        miscellenousChargesHtml += '</tr>';
                    });
                    
                    miscellenousChargesHtml+='<tr ><td colspan="4"><center><a target="_blank" href="/expense/tourBillClaim/miscellaneousCharge?tourBillClaimId='+tourBillClaimId+'" >View All</a></center></td></tr>';
                    miscellenousChargesHtml += '</tbody>'
                    $('#miscellaneousChargesTable').html(miscellenousChargesHtml);
                  } 
              })
              .fail((jqXHR, textStatus, err) => {
                $('#tourBillClaimTableSpinner').hide(); 
                  console.log('textStatus  '+textStatus);
                  
              })

// setting New Button form 
$('a.airRailBusCharges').click(() => {
            console.log('airRailBusCharges   anchor tag');
            
            var tourBillId = document.getElementById('tourbillId').innerHTML;;
            //alert('tourBillId  '+tourBillId);
            console.log('tourBillId   '+tourBillId);
           // location.assign('/expense/tourBillClaim/airRailBusCharges/'+tourBillId);
            window.open('/expense/tourBillClaim/airRailBusCharges/'+tourBillId,'_blank');
          });

          $('a.conveyanceCharges').click(() => {
            console.log('conveyanceCharges   anchor tag');
            var tourBillId = document.getElementById('tourbillId').innerHTML;
            console.log('tourBillId   '+tourBillId);
         //   location.assign('/expense/tourBillClaim/conveyanceCharges/'+tourBillId);
            window.open('/expense/tourBillClaim/conveyanceCharges/'+tourBillId,'_blank');
          });

          $('a.boardingLodgingCharges').click(() => {
            console.log('boardingLodgingCharges   anchor tag');
            var tourBillId = document.getElementById('tourbillId').innerHTML;
            console.log('tourBillId   : '+tourBillId);
           // location.assign('/expense/tourBillClaim/boardingLodgingCharges/'+tourBillId);
            window.open('/expense/tourBillClaim/boardingLodgingCharges/'+tourBillId,'_blank');
          });
          $('a.telephoneFood').click(() => {
            console.log('telephoneFood anchor tag');
            var tourBillId = document.getElementById('tourbillId').innerHTML;
            console.log('tourBillId   '+tourBillId);
         //   location.assign('/expense/tourBillClaim/telephoneFood/'+tourBillId);
            window.open('/expense/tourBillClaim/telephoneFood/'+tourBillId,'_blank');
          });
  
          $('a.miscellaneousCharges').click(() => {
            console.log('miscellaneousCharges anchor tag');
            var tourBillId = document.getElementById('tourbillId').innerHTML;
            console.log('tourBillId   '+tourBillId);
          //  location.assign('/expense/tourBillClaim/miscellenousCharges/'+tourBillId);
            window.open('/expense/tourBillClaim/miscellenousCharges/'+tourBillId,'_blank');
          });






    })
</script>